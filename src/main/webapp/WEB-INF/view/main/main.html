<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>洛林博客--小叶子为您服务</title>
<link rel="stylesheet" href="bootstrap/css/bootstrap.css" />
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
<link rel="stylesheet" href="css/main.css" />
<link rel="stylesheet" href="css/menu.css" />
<script type="text/javascript" src="js/jquery.tmpl.js"></script>
<script type="text/javascript" src="js/pages.js"></script>
</head>

<body>
	<div id="container">

		<!-- logo位置-->
		<div id="logo">
			<a href="javascript:void(0);"><img src="img/洛林博客.jpg" /></a> <span>--测试2.0小叶子诚心为各位服务</span>
		</div>

		<!-- 用户登录信息以及搜索框 -->
		<div id="user">
			<!--用户登录信息-->
			<div id="user_item" class="col-lg-4">
				<div class="notLogin">
					<span class="user_item_item" style="color: red">您还没有登录！</span><span
						class="user_item_item">|</span> <a href="javascript:void(0);"
						class="user_item_item">登录</a><span class="user_item_item">|</span>
					<a href="javascript:void(0);" class="user_item_item">注册</a>
				</div>
				<div class="inLogin" style="display: none;">
					<a href="#" class="user_item_item" id="inLoginNick"></a><span
						class="user_item_item">|</span> <a href="javascript:void(0);"
						class="user_item_item" onclick="">退出</a>
				</div>
			</div>
			<!--搜索框-->
			<div class="col-lg-4">
				<div class="input-group input-group-sm">
					<input type="text" class="form-control" placeholder="请输入搜索内容...">
					<span class="input-group-btn">
						<button class="btn btn-default" type="button"">搜索</button>
					</span>
				</div>
			</div>
		</div>

		<!-- 主菜单栏-->
		<div id="main_menu">
			<a href="javascript:void(0);">我的园子</a> <a href="javascript:void(0);">我的博客</a>
			<a href="javascript:void(0);">我的收藏</a> <a href="javascript:void(0);">我的消息(<span>2</span>)
			</a> <a href="javascript:void(0);">找找看</a> <a href="javascript:void(0);">意见箱</a>
		</div>

		<!-- 页面主体 -->
		<div id="main">
			<!-- 左侧列表 -->
			<div id="left_list">
				<!--左侧菜单栏  -->
				<div class="sidebar">
					<h2>搜索分类</h2>
					<ul id="menu">
						<!-- <li><a href="javascript:void(0);"
							onclick="$getTheCategory(1,1,'一级菜单一')">一级菜单一</a>
							<div class="erji">
								<div class="col_1">
									<h3>二级菜单</h3>
									<ul>
										<li><a href="javascript:void(0);"
											onclick="$getTheCategory(1,2,'Java')">Java</a></li>
										<li><a href="javascript:void(0);"
											onclick="$getTheCategory(2,2,'C++')">C++</a></li>
										<li><a href=" javascript:void(0); "
											onclick="$getTheCategory(3,2,'PHP')">PHP</a></li>
									</ul>
								</div>
							</div></li>
						<li><a href="javascript:void(0);"
							onclick="$getTheCategory(2,1,'一级菜单二')">一级菜单二</a></li>
						<li><a href=" javascript:void(0); "
							onclick="$getTheCategory(3,1,'一级菜单三')">一级菜单三</a></li> -->
						<!-- <div class="clear"></div> -->
					</ul>
				</div>

				<div class="xuxian"></div>

				<div id="statistics">
					<h3>统计信息</h3>
					<div>
						<ul>
							<li id="userSta">用户 - <span></span></li>
							<li id="bloggerSta">博主 - <span></span></li>
							<li id="blogSta">博客 - <span></span></li>
							<li id="commentSta">评论 - <span></span></li>
						</ul>
					</div>
				</div>
			</div>

			<!-- 文章列表导航栏 -->
			<div id="top_menu">
				<nav class="navbar navbar-default">
					<div class="container-fluid">
						<div class="collapse navbar-collapse"
							id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav">
								<li class="active"><a href="javascript:void(0);">首页 </a></li>
								<li><a href="javascript:void(0);">精选</a></li>
								<li><a href="javascript:void(0);">关注</a></li>
							</ul>

							<ul class="nav navbar-nav navbar-right">
								<li><a href="javascript:void(0);">刷新</a></li>
							</ul>
						</div>
					</div>
				</nav>
			</div>

			<!-- 右侧导航栏 -->
			<div class="right_list">
				<!-- 轮播图 -->
				<div style="margin-left: -10px;">
					<div id="carousel-example-generic" class="carousel slide"
						data-ride="carousel">
						<ol class="carousel-indicators">
							<li data-target="#carousel-example-generic" data-slide-to="0"
								class="active"></li>
							<li data-target="#carousel-example-generic" data-slide-to="1"></li>
							<li data-target="#carousel-example-generic" data-slide-to="2"></li>
							<li data-target="#carousel-example-generic" data-slide-to="3"></li>
						</ol>

						<div class="carousel-inner" role="listbox">
							<div class="item active">
								<a style="margin-left: 0;" href="http://www.baidu.com"
									target="_blank"><img src="img/lunbo1.png"></a>
							</div>
							<div class="item">
								<a style="margin-left: 0;" href="http://www.baidu.com"
									target="_blank"><img src="img/lunbo2.png"></a>
							</div>
							<div class="item">
								<a style="margin-left: 0;" href="http://www.baidu.com"
									target="_blank"><img src="img/lunbo3.png"></a>
							</div>
							<div class="item">
								<a style="margin-left: 0;" href="http://www.baidu.com"
									target="_blank"><img src="img/lunbo4.png"></a>
							</div>
						</div>

						<a class="left carousel-control" href="#carousel-example-generic"
							role="button" data-slide="prev" style="margin-left: 0px;"> <span
							class="glyphicon glyphicon-chevron-left"></span> <span
							class="sr-only">Previous</span>
						</a> <a class="right carousel-control"
							href="#carousel-example-generic" role="button" data-slide="next">
							<span class="glyphicon glyphicon-chevron-right"></span> <span
							class="sr-only">Next</span>
						</a>
					</div>
				</div>
				<div class="xuxian" style="margin-left: -5px;"></div>
				<!-- 推广 -->
				<div class="recommends">
					<!-- <div>
						<h3>程序员之家</h3>
						<ul>
							<li><a>【推荐】 博客园</a></li>
							<li><a>【推荐】 CSDN</a></li>
							<li><a>【推荐】 Java吧</a></li>
						</ul>
						<div class="xuxian" style="margin-left: -5px;"></div>
					</div>
					<div>
						<h3>生活之家</h3>
						<ul>
							<li><a>【推荐】 淘宝</a></li>
							<li><a>【推荐】 京东</a></li>
							<li><a>【推荐】 当当</a></li>
						</ul>
						<div class="xuxian" style="margin-left: -5px;"></div>
					</div>
					<div>
						<h3>新闻之家</h3>
						<ul>
							<li><a>【推荐】 腾讯新闻</a></li>
							<li><a>【推荐】 百度新闻</a></li>
							<li><a>【推荐】 凤凰新闻</a></li>
						</ul>
						<div class="xuxian" style="margin-left: -5px;"></div>
					</div>-->
				</div>
			</div>

			<!-- 文章列表 -->
			<div id="post_list">
				<!-- <div class='post_item'>
					<div class='post_item_body'>
						<div>
							<h4>
								<a href="javascript:void(0);" onclick="">文章一</a>
							</h4>
						</div>
						<div>
							<div style="float: left; margin-right: 5px;">
								<a href="#"><img src="img/noneAvatar.jpg" width="50"
									height="50" /></a>
							</div>
							<div>
								<span>&nbsp;
									欢迎各位来使用小叶子开发的博客系统，这个博客系统应该诸位见过的最烂的博客系统了吧，汗···。这款系统也算是小叶子独立开发的第一款小型系统，基本算是从无到有吧，技术研究也是在开发中同步进行，所以说呢，能力有限，诸位多多包</span>
							</div>
						</div>
						<div class="post_item_foot">
							<a href="#">小叶子</a> <span>发布于</span> <span
								class="glyphicon glyphicon-time">2017-11-02</span> <span
								class="glyphicon glyphicon-copyright-mark">评论量(10)</span> <span
								class="glyphicon glyphicon-share">浏览量(10)</span>
						</div>
						<div class="xuxian"></div>
					</div>
				</div> -->
			</div>

			<!-- 分页 -->
			<div id="pager_bottom">
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<li id="firstli"><a href="javascript:void(0);" onclick="">&laquo;</a>
						</li>
						<!--<li class="active page_item">
								<a href="javascript:void(0);" onclick="">1</a>
							</li>
							<li class="page_item">
								<a href="javascript:void(0);" onclick="">2</a>
							</li>
							<li class="page_item">
								<a href="javascript:void(0);" onclick="">3</a>
							</li>-->
						<li id="lastli"><a href="javascript:void(0);" onclick="">&raquo;</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>

		<!-- 脚部 -->
		<div id="footer">©2017 小叶子</div>
	</div>


	<script type="text/x-jquery-tmpl" id="t1">
							<li><a href="javascript:void(0);"
							onclick="$getTheCategory(${id},1,'${name}')">${name}</a>
							<div class="erji">
								<div class="col_1">
									<h3>${name}</h3>
									<ul>
										{{each(i,e) categorys}}
											<li><a href="javascript:void(0);"
											onclick="$getTheCategory(${id},2,'${e.name}')">${e.name}</a></li>
										{{/each}}
									</ul>
								</div>
							</div></li>
	</script>

	<script type="text/x-jquery-tmpl" id="t2">
					<div>
						<h3>${name}</h3>
						<ul>
							{{each(i,e) recommends}}
								<li><a href="${e.url}" target="_blank">【${e.tag}】 ${e.name}</a></li>
							{{/each}}
						</ul>
						<div class="xuxian" style="margin-left: -5px;"></div>
					</div>
	</script>

	<script type="text/x-jquery-tmpl" id="t3">
				<div class='post_item'>
					<div class='post_item_body'>
						<div>
							<h4>
								<a href="blogRead?aid=${id}" onclick="">${title}</a>
							</h4>
						</div>
						<div>
							<div style="float: left; margin-right: 5px;">
								<a href="blogPortal?uid=${user.id}"><img src="${userInfo.headpic}" width="50"
									height="50" /></a>
							</div>
							<div>
								<span>&nbsp;
									${content}</span>
							</div>
						</div>
						<div class="post_item_foot">
							<a href="blogPortal?uid=${user.id}">${user.nickname}</a> <span>发布于</span> <span
								class="glyphicon glyphicon-time">${dateFormat(leaveTime)}</span> <span
								class="glyphicon glyphicon-copyright-mark">评论量(${commentNum})</span> <span
								class="glyphicon glyphicon-share">浏览量(${viewNum})</span>
							<!--<span>类型：
								{{each(i,e) articalCategorys}}
									{{if i == articalCategorys.length-1 }}
										${e.name}
									{{/if}}
									{{if i != articalCategorys.length-1 }}
										${e.name}/
									{{/if}}
								{{/each}}
							</span>-->
						</div>
						<div class="xuxian"></div>
					</div>
				</div>
	</script>


	<script type="text/javascript">
		/*自定义分页的必备参数*/
		var currentPage = 1;
		var totalPage = 30;

		var style = 0;
		var category = 0;

		//转换时间
		function dateFormat(time) {
			var date = new Date(time);

			var str = "";
			str += date.getFullYear() + "-";
			if (date.getMonth() + 1 < 10) {
				str += "0" + (date.getMonth() + 1) + "-";
			} else {
				str += (date.getMonth() + 1) + "-";
			}
			if (date.getDate() < 10) {
				str += "0" + date.getDate() + " ";
			} else {
				str += date.getDate() + " ";
			}

			if (date.getHours() < 10) {
				str += "0" + date.getHours() + ":";
			} else {
				str += date.getHours() + ":";
			}
			if (date.getMinutes() < 10) {
				str += "0" + date.getMinutes();
			} else {
				str += date.getMinutes();
			}

			return str;
		}

		$(function() {

			$("#logo a").click(function() {
				window.location.reload();
			});

			$("#user_item a:eq(0)").click(function() {
				window.location.href = "loginForm";
			});

			$("#user_item a:eq(1)").click(function() {
				window.location.href = "phemRegister";
			});

			$("#user_item a:eq(2)").click(function() {
				alert("hello");
			});

			$("#user_item a:eq(3)").click(function() {
				if (confirm("logout?")) {
					$logOut();
				}
			});

			$("#user button").click(
					function() {
						var content = encodeURI(encodeURI($.trim($(
								"#user input").val())));
						window.location.href = "looking?key=" + content;
					});

			$("#main_menu a:eq(0)").click(function() {
				$jumpOthers("userinfo", "");
			});

			//跳转至博客模块
			$("#main_menu a:eq(1)").click(function() {
				$jumpToBlog();
			});

			$("#main_menu a:eq(2)")
					.click(
							function() {
								$jumpOthers("userinfo",
										"&consule=%25E6%2588%2591%25E7%259A%2584%25E6%2594%25B6%25E8%2597%258F")
							});

			$("#main_menu a:eq(3)")
					.click(
							function() {
								$jumpOthers("userinfo",
										"&consule=%25E6%2588%2591%25E7%259A%2584%25E6%25B6%2588%25E6%2581%25AF")
							});

			$("#main_menu a:eq(4)").click(function() {
				alert("找找看暂未实现");
			});

			$("#main_menu a:eq(5)").click(function() {
				window.location.href = "suggestion";
			});

		});

		var $getTheCategory = function(id, level, name) {
			console.log("选择的是" + level + "级菜单,编号为" + id);
			$("#top_menu ul:eq(0) li").removeClass("active");
			$("#top_menu ul:eq(0) li:eq(3)").remove();
			$("#top_menu ul:eq(0)").append(
					'<li class="active"><a href="javascript:void(0);">' + name
							+ '</a></li>');
			currentPage = 1;
			style = 100;
			category = id;
			$(".page_item").remove();
			$("#post_list").empty();
			$getPageItems(currentPage, style, category);
		}

		$(function() {

			$("#top_menu ul:eq(0) li").click(function() {
				var temp = $.trim($(this).text());
				if (temp == "首页") {
					$(this).siblings("li").removeClass("active");
					$(this).addClass("active");
					$("#top_menu ul:eq(0) li:eq(3)").remove();
					style = 0;
				} else if (temp == "关注") {
					alert("功能暂未实现");
					return;
					$(this).siblings("li").removeClass("active");
					$(this).addClass("active");
					$("#top_menu ul:eq(0) li:eq(3)").remove();
					style = 2;
				} else if (temp == "精选") {
					$(this).siblings("li").removeClass("active");
					$(this).addClass("active");
					$("#top_menu ul:eq(0) li:eq(3)").remove();
					style = 1;
				}
				currentPage = 1;
				category = 0;
				$(".page_item").remove();
				$("#post_list").empty();
				$getPageItems(currentPage, style, category);
			});

			$("#top_menu ul:eq(1) li:eq(0)").click(function() {
				currentPage = 1;
				$(".page_item").remove();
				$("#post_list").empty();
				$getPageItems(currentPage, style, category);
			});

		});

		/*左侧菜单逻辑*/
		$(function() {
			$getCategorys();
			$getPortalStatistics();
		});

		//获取分类
		var $getCategorys = function() {
			$.ajax({
				type : "get",
				url : "getCategorys",
				async : true,
				success : function(data) {
					console.log(data);
					$("#t1").tmpl(data).appendTo("#menu");
					$("#menu").append('<div class="clear"></div>');
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}

		//获取统计
		var $getPortalStatistics = function() {
			$.ajax({
				type : "get",
				url : "getPortalStatistics",
				async : true,
				success : function(data) {
					console.log(data);
					$("#userSta").html(
							'用户 - <span>' + data.userCount + '</span>');
					$("#bloggerSta").html(
							'博主 - <span>' + data.bloggerCount + '</span>');
					$("#blogSta").html(
							'博客 - <span>' + data.blogCount + '</span>');
					$("#commentSta").html(
							'评论 - <span>' + data.commentCount + '</span>');
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}

		/*文章逻辑*/
		$(function() {
			$getPageItems(currentPage, style, category);
		});

		//获取文章
		var $getPageItems = function(current, style, category) {
			$.ajax({
				type : "get",
				url : "getMainArticals",
				dataType : "json",
				data : {
					current : current,
					category : category,
					style : style
				},
				async : true,
				success : function(data) {
					console.log(data);
					$("#t3").tmpl(data.oList).appendTo("#post_list");
					totalPage = data.totalPages;
					$getPages();
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}

		/*自定义分页的逻辑*/
		$(function() {

			$(document).on(
					"click",
					".pagination li",
					function() {
						var current = $.trim($(this).text());
						if (current == "«") {
							var temp = $.trim($(".pagination li.active").prev()
									.text());
							if (temp != "«") {
								var $a = $(".pagination li.active");
								$(".pagination li.active")
										.removeClass("active");
								$a.prev().addClass("active");
								currentPage = parseInt($.trim($(
										".pagination li.active").text()));
								$(".page_item").remove();
								//$getPages();
								$("#post_list").empty();
								$getPageItems(currentPage, style, category);
							}
						} else if (current == "»") {
							var temp = $.trim($(".pagination li.active").next()
									.text());
							if (temp != "»") {
								var $a = $(".pagination li.active");
								$(".pagination li.active")
										.removeClass("active");
								$a.next().addClass("active");
								currentPage = parseInt($.trim($(
										".pagination li.active").text()));
								$(".page_item").remove();
								//$getPages();
								$("#post_list").empty();
								$getPageItems(currentPage, style, category);
							}
						} else if (current == "...") {

						} else {
							$(this).siblings("li").removeClass("active");
							$(this).addClass("active");
							currentPage = parseInt($.trim($(
									".pagination li.active").text()));
							$(".page_item").remove();
							//$getPages();
							$("#post_list").empty();
							$getPageItems(currentPage, style, category);
						}
					});

		});

		/*右侧导航栏逻辑*/
		$(function() {
			$getRecommends();
		});

		//获取推荐
		var $getRecommends = function() {
			$.ajax({
				type : "get",
				url : "getRecommends",
				async : true,
				success : function(data) {
					console.log(data);
					$("#t2").tmpl(data).appendTo(".recommends");
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}

		/*登录逻辑*/
		$(function() {
			$getTheLoginStatus();
		});

		//获取登录状态
		var $getTheLoginStatus = function() {
			$.ajax({
				type : "get",
				url : "getTheLoginStatus",
				async : true,
				success : function(data) {
					console.log(data);
					if (data != "") {
						$(".notLogin").css("display", "none");
						$("#inLoginNick").text(data.nickname);
						$(".inLogin").css("display", "");
					}
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}

		//登出
		var $logOut = function() {
			$.ajax({
				type : "get",
				url : "logOut",
				async : true,
				success : function(data) {
					console.log(data);
					$(".notLogin").css("display", "");
					$(".inLogin").css("display", "none");
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}

		/*相关跳转逻辑*/
		var $jumpOthers = function(address, consule) {
			$.ajax({
				type : "get",
				url : "jumpOthers",
				data : {
					address : address
				},
				async : true,
				success : function(data) {
					console.log(data);
					if (data == 0) {
						alert("请先登录")
					} else {
						window.location.href = address + "?id=" + data
								+ consule;
					}
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}
		
		//跳转至博客主页
		var $jumpToBlog = function() {
			$.ajax({
				type : "get",
				url : "jumpToBlog",
				data : {
				},
				async : true,
				success : function(data) {
					console.log(data);
					if (data == 0) {
						alert("请先登录")
					} else if(data == -1){
						alert("您不是博主！");
					} else {
						window.location.href = "blogPortal?uid=" + data;
					}
				},
				error : function() {
					alert("数据获取失败");
				}
			});
		}
	</script>
</body>

</html>